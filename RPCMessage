package com.cs5300.pj1;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.Serializable;


public abstract class RPCMessage implements Serializable {
    private static final long serialVersionUID = -6093564626696863788L;
    public final static int BUFFER_SIZE = 512;
    public final static String LENGTH_EXCEEDED = "Message Exceeds Maximum Packet Length";

    public int call_ID;  // RPC call ID, increment after each call

    public RPCMessage(int call_ID) {
        this.call_ID = call_ID;
    }

    public int getCallID() {
        return call_ID;
    }

    public void setCallID(int call_ID) {
        this.call_ID = call_ID;
    }

    public byte[] toByteStream() {
        byte[] bytes = null;
        try {
            ByteArrayOutputStream bStream = new ByteArrayOutputStream();
            ObjectOutputStream oStream = new ObjectOutputStream(bStream);
            oStream.writeObject(this);
            bytes = bStream.toByteArray();
        } catch(Exception e) {
            System.err.println("Error writing RPCMessage to byte stream");
            e.printStackTrace();
        }
        return bytes;
    }

    public static RPCMessage readByteStream(byte[] inBuf) {
        RPCMessage msg = null;
        try {
            ByteArrayInputStream bStream = new ByteArrayInputStream(inBuf);
            ObjectInputStream iStream = new ObjectInputStream(bStream);
            msg = (RPCMessage)iStream.readObject();
        } catch(Exception e) {
            System.err.println("Error reading byte stream into RPCMessage");
            e.printStackTrace();
        }
        return msg;
    }

    // Judge if packet has validate length
    public boolean validatePacket() {
        if(this.toByteStream().length > BUFFER_SIZE)
            throw new RuntimeException(LENGTH_EXCEEDED);
        return true;
    }
 }
